# Oracle AWR 报告分析软件 - 工作分解结构 (WBS)

**文档版本**: v1.0
**创建日期**: 2025-10-02
**项目周期**: 16-20 周

---

## 1. 项目整体规划

### 1.1 开发阶段

| 阶段 | 时间 | 目标 | 里程碑 |
|-----|------|------|--------|
| **Phase 1: MVP** | Week 1-6 | 核心功能原型 | M1: MVP 演示 |
| **Phase 2: 完整功能** | Week 7-14 | 完整业务功能 | M2: Beta 版本 |
| **Phase 3: 优化增强** | Week 15-20 | 性能优化和增强 | M3: 正式发布 |
| **Phase 4: 运维迭代** | 持续 | 持续改进 | - |

---

## 2. Phase 1: MVP (Week 1-6)

### 2.1 Week 1-2: 环境搭建和基础架构

#### 2.1.1 开发环境搭建 (2天)

**负责人**: 全员

**任务**:
- [ ] 安装开发工具 (VSCode/PyCharm, Node.js, Python 3.11+)
- [ ] 配置 Git 仓库和分支策略
- [ ] 配置 Docker Desktop
- [ ] 本地数据库环境搭建 (PostgreSQL + Redis)
- [ ] IDE 插件和代码规范配置 (ESLint, Pylint)

**交付物**:
- 开发环境文档
- Git 仓库 README

**验收标准**:
- 所有开发人员能正常启动本地环境
- Git 提交规范一致

---

#### 2.1.2 后端基础架构 (3天)

**负责人**: 后端工程师

**任务**:
- [ ] 创建 FastAPI 项目结构
- [ ] 配置 SQLAlchemy + Alembic
- [ ] 实现数据库模型 (AWRReport, PerformanceMetric)
- [ ] 配置 Pydantic 模式
- [ ] 实现数据库连接和会话管理
- [ ] 配置日志系统
- [ ] 配置 CORS 和中间件
- [ ] 编写健康检查接口 `/health`

**交付物**:
- `backend/` 目录结构
- 数据库迁移脚本
- API 基础框架

**验收标准**:
- `uvicorn app.main:app --reload` 能正常启动
- 访问 `http://localhost:8000/docs` 可查看 Swagger 文档
- 数据库表成功创建

---

#### 2.1.3 前端基础架构 (3天)

**负责人**: 前端工程师

**任务**:
- [ ] 使用 Vite + React + TypeScript 创建项目
- [ ] 集成 Ant Design Pro 框架
- [ ] 配置路由 (React Router)
- [ ] 配置 Axios 和 API 服务层
- [ ] 实现全局状态管理 (Zustand)
- [ ] 实现布局组件 (Header, Sidebar, Content)
- [ ] 配置 ECharts

**交付物**:
- `frontend/` 目录结构
- 基础路由和布局
- API 服务封装

**验收标准**:
- `npm run dev` 能正常启动
- 访问 `http://localhost:3000` 看到登录页面
- Axios 能调用后端健康检查接口

---

#### 2.1.4 Docker 开发环境 (2天)

**负责人**: DevOps 工程师

**任务**:
- [ ] 编写 `docker-compose.dev.yml`
- [ ] 配置 PostgreSQL 容器
- [ ] 配置 Redis 容器
- [ ] 配置后端开发容器 (热重载)
- [ ] 配置前端开发容器
- [ ] 编写启动脚本 `dev.sh`

**交付物**:
- `docker-compose.dev.yml`
- 启动文档

**验收标准**:
- `docker-compose up` 一键启动所有服务
- 后端和前端代码修改自动热重载

---

### 2.2 Week 3-4: 核心功能开发 (上传和解析)

#### 2.2.1 文件上传 API (2天)

**负责人**: 后端工程师

**任务**:
- [ ] 实现 POST `/api/v1/reports/upload` 接口
- [ ] 文件校验逻辑 (格式、大小)
- [ ] 文件存储逻辑 (本地文件系统)
- [ ] 创建 AWRReport 数据库记录
- [ ] 错误处理和响应

**交付物**:
- 文件上传 API
- `app/services/file_service.py`

**验收标准**:
- 能通过 Postman 上传 HTML 文件
- 文件正确保存到 `uploads/` 目录
- 数据库中创建对应记录

---

#### 2.2.2 前端上传页面 (2天)

**负责人**: 前端工程师

**任务**:
- [ ] 实现拖拽上传组件
- [ ] 集成 Ant Design Upload 组件
- [ ] 实现上传进度显示
- [ ] 实现上传成功/失败提示
- [ ] 实现上传历史列表

**交付物**:
- `src/pages/Home/` 上传页面
- `src/components/FileUpload/` 组件

**验收标准**:
- 能拖拽或点击上传文件
- 上传进度实时显示
- 上传成功后列表刷新

---

#### 2.2.3 Oracle 19c AWR 解析器 (4天)

**负责人**: 后端工程师 (核心开发者)

**任务**:
- [ ] 实现 `BaseAWRParser` 基类
- [ ] 实现版本检测逻辑 `detect_oracle_version()`
- [ ] 实现 `Oracle19cParser` 类
  - [ ] 解析实例信息
  - [ ] 解析快照信息
  - [ ] 解析 Load Profile
  - [ ] 解析 Top 5 等待事件
  - [ ] 解析 Top 10 SQL (按 CPU)
- [ ] 实现数值解析工具函数 `_parse_value()`
- [ ] 实现表格定位工具函数 `_find_table_by_header()`
- [ ] 编写解析器单元测试

**交付物**:
- `app/core/parser/` 模块
- 解析器测试用例

**验收标准**:
- 能成功解析 Oracle 19c AWR HTML 报告
- 提取的核心指标准确 (与原始报告对比)
- 单元测试覆盖率 > 80%

---

#### 2.2.4 Celery 异步任务 (3天)

**负责人**: 后端工程师

**任务**:
- [ ] 配置 Celery + Redis
- [ ] 实现 `parse_awr_report_task` 异步任务
- [ ] 实现任务状态更新逻辑
- [ ] 实现任务监控接口 GET `/api/v1/tasks/{task_id}`
- [ ] 配置 Celery Worker 容器

**交付物**:
- `app/tasks/` 模块
- Celery Worker 配置

**验收标准**:
- 上传文件后自动触发解析任务
- 能查询任务状态 (pending/running/success/failure)
- Celery Worker 日志正常输出

---

### 2.3 Week 5: 数据展示

#### 2.3.1 报告列表 API (1天)

**负责人**: 后端工程师

**任务**:
- [ ] 实现 GET `/api/v1/reports` 接口
- [ ] 实现分页逻辑
- [ ] 实现过滤逻辑 (db_name, date_range)
- [ ] 实现排序逻辑

**交付物**:
- 报告列表 API

**验收标准**:
- 能返回分页的报告列表
- 过滤和排序功能正常

---

#### 2.3.2 报告列表页面 (2天)

**负责人**: 前端工程师

**任务**:
- [ ] 实现报告列表 Table 组件
- [ ] 实现搜索和过滤器
- [ ] 实现分页器
- [ ] 实现状态标签显示
- [ ] 实现操作按钮 (查看/删除)

**交付物**:
- `src/pages/ReportList/` 页面

**验收标准**:
- 列表正确显示已上传的报告
- 搜索和过滤功能正常
- 分页跳转正常

---

#### 2.3.3 报告详情 API (2天)

**负责人**: 后端工程师

**任务**:
- [ ] 实现 GET `/api/v1/reports/{id}` 接口
- [ ] 实现 GET `/api/v1/reports/{id}/metrics/{category}` 接口
- [ ] 实现 Redis 缓存逻辑

**交付物**:
- 报告详情 API
- 缓存服务

**验收标准**:
- 能返回报告基本信息和性能指标
- 首次查询后缓存生效

---

#### 2.3.4 报告详情页面 (3天)

**负责人**: 前端工程师

**任务**:
- [ ] 实现概览卡片 (关键指标)
- [ ] 实现 Tab 导航
- [ ] 实现 Load Profile 表格展示
- [ ] 实现等待事件饼图 (ECharts)
- [ ] 实现 Top SQL 表格展示

**交付物**:
- `src/pages/ReportDetail/` 页面
- 图表组件

**验收标准**:
- 详情页正确显示报告数据
- 图表渲染正确
- Tab 切换流畅

---

### 2.4 Week 6: MVP 完善和演示准备

#### 2.4.1 基础诊断规则 (3天)

**负责人**: 后端工程师 + DBA 顾问

**任务**:
- [ ] 设计规则 YAML 格式
- [ ] 编写 5 条基础诊断规则:
  - [ ] HIGH_CPU_USAGE (CPU 使用率过高)
  - [ ] LOW_BUFFER_HIT_RATIO (缓冲区命中率低)
  - [ ] HIGH_PHYSICAL_READS (物理读过高)
  - [ ] DB_FILE_SEQ_READ_HIGH (db file sequential read 等待高)
  - [ ] TOP_SQL_HIGH_CPU (Top SQL CPU 消耗过高)
- [ ] 实现 `RuleEngine` 类
- [ ] 实现诊断 API POST `/api/v1/reports/{id}/analyze`
- [ ] 实现诊断结果 API GET `/api/v1/reports/{id}/diagnostics`

**交付物**:
- `app/rules/*.yaml` 规则文件
- `app/core/analyzer/rule_engine.py`
- 诊断 API

**验收标准**:
- 规则能正确匹配性能问题
- 诊断结果包含问题描述和建议

---

#### 2.4.2 诊断结果页面 (2天)

**负责人**: 前端工程师

**任务**:
- [ ] 实现诊断摘要卡片
- [ ] 实现问题列表 (按严重程度分组)
- [ ] 实现问题详情展开面板
- [ ] 实现严重程度标签颜色

**交付物**:
- `src/pages/Diagnostic/` 页面

**验收标准**:
- 诊断结果清晰展示
- 严重问题优先显示

---

#### 2.4.3 MVP 测试和修复 (3天)

**负责人**: 全员

**任务**:
- [ ] 端到端测试 (上传-解析-展示-诊断)
- [ ] 修复发现的 Bug
- [ ] 性能测试 (解析 5MB 文件)
- [ ] 准备演示数据
- [ ] 编写 MVP 演示脚本

**交付物**:
- Bug 修复列表
- 演示文档

**验收标准**:
- MVP 核心流程无阻塞性 Bug
- 演示流畅完成

---

## 3. Phase 2: 完整功能 (Week 7-14)

### 3.1 Week 7-8: 多版本支持

#### 3.1.1 Oracle 12c 解析器 (3天)

**任务**:
- [ ] 实现 `Oracle12cParser`
- [ ] 处理 CDB/PDB 容器数据库特性
- [ ] 测试 12.1 和 12.2 版本

---

#### 3.1.2 Oracle 11g 解析器 (3天)

**任务**:
- [ ] 实现 `Oracle11gParser`
- [ ] 处理 11g 特有格式差异
- [ ] 测试 11.2.0.4 版本

---

#### 3.1.3 解析器工厂和测试 (2天)

**任务**:
- [ ] 完善 `AWRParserFactory`
- [ ] 收集各版本测试样本
- [ ] 编写集成测试
- [ ] 测试各版本解析成功率

---

### 3.2 Week 9-10: 对比分析功能

#### 3.2.1 对比引擎 (3天)

**任务**:
- [ ] 实现 `ComparisonEngine` 类
- [ ] 实现 Load Profile 对比算法
- [ ] 实现等待事件对比算法
- [ ] 实现 SQL 对比算法 (SQL_ID 匹配)
- [ ] 计算差异百分比和趋势

---

#### 3.2.2 对比 API (2天)

**任务**:
- [ ] 实现 POST `/api/v1/comparisons` 接口
- [ ] 实现 GET `/api/v1/comparisons/{id}` 接口
- [ ] 存储对比结果到数据库

---

#### 3.2.3 对比分析页面 (3天)

**任务**:
- [ ] 实现报告选择器 (基线 vs 目标)
- [ ] 实现并排对比视图
- [ ] 实现差异高亮显示
- [ ] 实现趋势图表 (折线图)

---

### 3.3 Week 11-12: 完善诊断规则

#### 3.3.1 扩展规则库 (4天)

**负责人**: 后端工程师 + DBA 团队

**任务**:
- [ ] 编写 30+ 诊断规则,覆盖:
  - [ ] CPU 类规则 (5 条)
  - [ ] 内存类规则 (5 条)
  - [ ] IO 类规则 (5 条)
  - [ ] SQL 类规则 (8 条)
  - [ ] 等待事件类规则 (7 条)
- [ ] 实现复杂规则 (多指标联合判断)
- [ ] 规则验证和测试

---

#### 3.3.2 指标计算器 (2天)

**任务**:
- [ ] 实现 `MetricsCalculator` 类
- [ ] 计算衍生指标:
  - [ ] CPU 使用率
  - [ ] Buffer Cache 命中率
  - [ ] 平均活跃会话数
  - [ ] 硬解析率
  - [ ] SQL 效率评分

---

#### 3.3.3 异常检测器 (2天)

**任务**:
- [ ] 实现 `AnomalyDetector` 类
- [ ] 实现统计检测算法 (3-sigma)
- [ ] 实现趋势分析 (线性回归)

---

### 3.4 Week 13-14: 报告导出

#### 3.4.1 PDF 导出 (3天)

**任务**:
- [ ] 设计 PDF 报告模板 (Jinja2)
- [ ] 实现 `PDFExporter` 类 (WeasyPrint)
- [ ] 处理中文字体
- [ ] 实现 GET `/api/v1/reports/{id}/export?format=pdf`

---

#### 3.4.2 Excel 导出 (2天)

**任务**:
- [ ] 实现 `ExcelExporter` 类 (openpyxl)
- [ ] 多 Sheet 设计 (概览/Load Profile/SQL/诊断)
- [ ] 实现样式和格式
- [ ] 实现 GET `/api/v1/reports/{id}/export?format=excel`

---

#### 3.4.3 导出页面 (2天)

**任务**:
- [ ] 实现导出格式选择
- [ ] 实现内容定制 (选择导出章节)
- [ ] 实现下载进度提示

---

### 3.5 Beta 测试和优化 (Week 13-14 并行)

**任务**:
- [ ] 邀请 10+ 内部用户测试
- [ ] 收集反馈和 Bug 报告
- [ ] 性能优化
- [ ] UI/UX 改进
- [ ] 修复 Bug

---

## 4. Phase 3: 优化增强 (Week 15-20)

### 4.1 Week 15-16: 高级特性

#### 4.1.1 RAC 支持 (4天)

**任务**:
- [ ] 实现 `RACParser` 类
- [ ] 解析多节点信息
- [ ] 实现跨节点对比
- [ ] 测试 RAC AWR 报告

---

#### 4.1.2 趋势分析 (3天)

**任务**:
- [ ] 实现多时段趋势图 (3+ 报告)
- [ ] 实现时间序列图表
- [ ] 实现趋势预测 (可选)

---

#### 4.1.3 自定义规则配置 (3天)

**任务**:
- [ ] 实现规则管理界面
- [ ] 实现阈值配置
- [ ] 实现规则启用/禁用

---

### 4.2 Week 17-18: 性能优化

**任务**:
- [ ] 数据库查询优化 (索引分析)
- [ ] Redis 缓存优化 (缓存策略)
- [ ] 前端性能优化 (代码分割、懒加载)
- [ ] 大文件解析优化 (流式处理)
- [ ] 并发测试 (100 用户)

---

### 4.3 Week 19-20: 测试和文档

#### 4.3.1 完整测试 (5天)

**任务**:
- [ ] 单元测试补充 (覆盖率 > 70%)
- [ ] 集成测试编写
- [ ] 端到端测试 (Playwright/Cypress)
- [ ] 压力测试
- [ ] 安全测试 (OWASP Top 10)

---

#### 4.3.2 文档编写 (3天)

**任务**:
- [ ] 用户手册
- [ ] API 文档 (OpenAPI)
- [ ] 部署文档
- [ ] 运维手册
- [ ] 开发者文档

---

#### 4.3.3 Docker 生产部署 (2天)

**任务**:
- [ ] 编写生产 Dockerfile
- [ ] 编写 docker-compose.prod.yml
- [ ] 配置 Nginx 反向代理
- [ ] 配置 SSL 证书
- [ ] 编写部署脚本

---

## 5. Phase 4: 持续运维 (Week 21+)

### 5.1 监控和日志

**任务**:
- [ ] 集成 Prometheus + Grafana
- [ ] 配置性能指标监控
- [ ] 配置告警规则
- [ ] 集成日志收集 (ELK/Loki)

---

### 5.2 持续改进

**任务**:
- [ ] 用户反馈跟踪
- [ ] Bug 修复
- [ ] 功能迭代
- [ ] 性能持续优化

---

## 6. 人力资源分配

| 角色 | 人数 | 职责 |
|-----|------|------|
| 后端工程师 | 2 | API 开发、解析器、分析引擎 |
| 前端工程师 | 1-2 | UI 开发、图表集成 |
| DevOps 工程师 | 0.5 | Docker、CI/CD |
| DBA 顾问 | 0.5 | 诊断规则设计、测试验证 |
| 测试工程师 | 1 | 测试用例编写、测试执行 |
| 产品经理 | 0.5 | 需求管理、用户反馈 |

**总计**: 5-6 人

---

## 7. 风险和依赖

### 7.1 关键路径

1. **AWR 解析器** → 数据展示 → 诊断分析
2. 前后端基础架构 → 所有功能开发

### 7.2 风险缓解

- **解析器复杂性**: 提前收集多版本样本,预留 Buffer 时间
- **规则准确性**: 邀请资深 DBA 参与评审
- **性能问题**: 尽早进行性能测试,及时优化

---

## 8. 交付清单

### 8.1 MVP (Week 6)

- [x] 可运行的 Web 应用
- [x] 支持 Oracle 19c AWR 解析
- [x] 基本性能指标展示
- [x] 5 条诊断规则
- [x] Docker 开发环境

### 8.2 Beta 版本 (Week 14)

- [ ] 支持 Oracle 11g/12c/19c
- [ ] 完整性能指标展示
- [ ] 30+ 诊断规则
- [ ] 对比分析功能
- [ ] PDF/Excel 导出
- [ ] 集成测试

### 8.3 正式发布 (Week 20)

- [ ] 所有计划功能完成
- [ ] 性能达标 (解析 < 10s, 响应 < 2s)
- [ ] 测试覆盖率 > 70%
- [ ] 完整文档
- [ ] Docker 生产部署方案

---

**文档状态**: 进行中
**维护人**: 项目经理
